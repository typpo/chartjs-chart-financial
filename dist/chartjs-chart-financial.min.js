/*!
 * @license
 * chartjs-chart-financial
 * http://chartjs.org/
 * Version: 0.1.0
 *
 * Copyright 2022 Chart.js Contributors
 * Released under the MIT license
 * https://github.com/chartjs/chartjs-chart-financial/blob/master/LICENSE.md
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("chart.js-v3")):"function"==typeof define&&define.amd?define(["chart.js-v3"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ChartJs)}(this,(function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l=t(e);const{BarController:a,defaults:o}=l.default,{clipArea:n,isNullOrUndef:r,unclipArea:i}=l.default.helpers;class s extends a{getLabelAndValue(e){const t=this,l=t.getParsed(e),a=t._cachedMeta.iScale.axis,{o:o,h:n,l:r,c:i}=l,s=`O: ${o}  H: ${n}  L: ${r}  C: ${i}`;return{label:`${t._cachedMeta.iScale.getLabelForValue(l[a])}`,value:s}}getAllParsedValues(){const e=this._cachedMeta,t=e.iScale.axis,l=e._parsed,a=[];for(let e=0;e<l.length;++e)a.push(l[e][t]);return a}getMinMax(e){const t=this._cachedMeta,l=t._parsed,a=t.iScale.axis;if(l.length<2)return{min:0,max:1};if(e===t.iScale)return{min:l[0][a],max:l[l.length-1][a]};let o=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;for(let e=0;e<l.length;e++){const t=l[e];o=Math.min(o,t.l),n=Math.max(n,t.h)}return{min:o,max:n}}_getRuler(){const e=this,t=e.options,l=e._cachedMeta,a=l.iScale,o=a.axis,n=[];for(let t=0;t<l.data.length;++t)n.push(a.getPixelForValue(e.getParsed(t)[o]));const r=t.barThickness,i=function(e,t){let l,a,o,n,r=e._length;for(o=1,n=t.length;o<n;++o)r=Math.min(r,Math.abs(t[o]-t[o-1]));for(o=0,n=e.ticks.length;o<n;++o)a=e.getPixelForTick(o),r=o>0?Math.min(r,Math.abs(a-l)):r,l=a;return r}(a,n);return{min:i,pixels:n,start:a._startPixel,end:a._endPixel,stackCount:e._getStackCount(),scale:a,ratio:r?1:t.categoryPercentage*t.barPercentage}}calculateElementProperties(e,t,l,a){const o=this,n=o._cachedMeta.vScale,r=n.getBasePixel(),i=o._calculateBarIndexPixels(e,t,a),s=o.chart.data.datasets[o.index].data[e],c=n.getPixelForValue(s.o),d=n.getPixelForValue(s.h),h=n.getPixelForValue(s.l),u=n.getPixelForValue(s.c);return{base:l?r:h,x:i.center,y:(h+d)/2,width:i.size,open:c,high:d,low:h,close:u}}draw(){const e=this,t=e.chart,l=e._cachedMeta.data;n(t.ctx,t.chartArea);for(let t=0;t<l.length;++t)l[t].draw(e._ctx);i(t.ctx)}}s.overrides={label:"",parsing:!1,hover:{mode:"label"},datasets:{categoryPercentage:.8,barPercentage:.9,animation:{numbers:{type:"number",properties:["x","y","base","width","open","high","low","close"]}}},scales:{x:{type:"timeseries",offset:!0,ticks:{major:{enabled:!0},fontStyle:e=>e.tick.major?"bold":void 0,source:"data",maxRotation:0,autoSkip:!0,autoSkipPadding:75,sampleSize:100},afterBuildTicks:e=>{const t=e._majorUnit,l=e.ticks,a=l[0];if(!a)return;let o=new Date(a.value);"minute"===t&&0===o.getSeconds()||"hour"===t&&0===o.getMinutes()||"day"===t&&9===o.getHours()||"month"===t&&o.getDate()<=3&&1===o.getDay()||"year"===t&&1===o.getMonth()?a.major=!0:a.major=!1;let n="minute"===t?o.getMinutes():"hour"===t?o.getHours():"day"===t?o.getDate():"month"===t?o.getMonth():o.getFullYear();for(let e=1;e<l.length;e++){const a=l[e];o=new Date(a.value);const r="minute"===t?o.getMinutes():"hour"===t?o.getHours():"day"===t?o.getDate():"month"===t?o.getMonth():o.getFullYear();a.major=r!==n,n=r}e.ticks=l}},y:{type:"linear"}},plugins:{tooltip:{intersect:!1,mode:"index",callbacks:{label(e){const t=e.parsed;if(!r(t.y))return o.plugins.tooltip.callbacks.label(e);const{o:l,h:a,l:n,c:i}=t;return`O: ${l}  H: ${a}  L: ${n}  C: ${i}`}}}}};function c(e,t,l,a){const o=null===t,n=null===l,r=!(!e||o&&n)&&function(e,t){const{x:l,y:a,base:o,width:n,height:r}=e.getProps(["x","low","high","width","height"],t);let i,s,c,d,h;return e.horizontal?(h=r/2,i=Math.min(l,o),s=Math.max(l,o),c=a-h,d=a+h):(h=n/2,i=l-h,s=l+h,c=Math.min(a,o),d=Math.max(a,o)),{left:i,top:c,right:s,bottom:d}}(e,a);return r&&(o||t>=r.left&&t<=r.right)&&(n||l>=r.top&&l<=r.bottom)}e.Chart.defaults.elements.financial={color:{up:"rgba(80, 160, 115, 1)",down:"rgba(215, 85, 65, 1)",unchanged:"rgba(90, 90, 90, 1)"}};class d extends e.Element{height(){return this.base-this.y}inRange(e,t,l){return c(this,e,t,l)}inXRange(e,t){return c(this,e,null,t)}inYRange(e,t){return c(this,null,e,t)}getRange(e){return"x"===e?this.width/2:this.height/2}getCenterPoint(e){const{x:t,low:l,high:a}=this.getProps(["x","low","high"],e);return{x:t,y:(a+l)/2}}tooltipPosition(e){const{x:t,open:l,close:a}=this.getProps(["x","open","close"],e);return{x:t,y:(l+a)/2}}}const h=l.default.Chart,{merge:u,valueOrDefault:g}=l.default.helpers,m=h.defaults;class p extends d{draw(e){const t=this,{x:l,open:a,high:o,low:n,close:r}=t;let i,s=t.borderColor;"string"==typeof s&&(s={up:s,down:s,unchanged:s}),r<a?(i=g(s?s.up:void 0,m.elements.candlestick.borderColor),e.fillStyle=g(t.color?t.color.up:void 0,m.elements.candlestick.color.up)):r>a?(i=g(s?s.down:void 0,m.elements.candlestick.borderColor),e.fillStyle=g(t.color?t.color.down:void 0,m.elements.candlestick.color.down)):(i=g(s?s.unchanged:void 0,m.elements.candlestick.borderColor),e.fillStyle=g(t.color?t.color.unchanged:void 0,m.elements.candlestick.color.unchanged)),e.lineWidth=g(t.borderWidth,m.elements.candlestick.borderWidth),e.strokeStyle=g(i,m.elements.candlestick.borderColor),e.beginPath(),e.moveTo(l,o),e.lineTo(l,Math.min(a,r)),e.moveTo(l,n),e.lineTo(l,Math.max(a,r)),e.stroke(),e.fillRect(l-t.width/2,r,t.width,a-r),e.strokeRect(l-t.width/2,r,t.width,a-r),e.closePath()}}p.id="candlestick",p.defaults=u({},[m.elements.financial,{borderColor:m.elements.financial.color.unchanged,borderWidth:1}]);const f=l.default.Chart,{merge:b}=l.default.helpers;class x extends s{updateElements(e,t,l,a){const o=this,n=o.getDataset(),r=o._ruler||o._getRuler(),i=o.resolveDataElementOptions(t,a),s=o.getSharedOptions(i),c=o.includeOptions(a,s);o.updateSharedOptions(s,a,i);for(let i=t;i<l;i++){const t=s||o.resolveDataElementOptions(i,a),l={...o.calculateElementProperties(i,r,"reset"===a,t),datasetLabel:n.label||"",color:n.color,borderColor:n.borderColor,borderWidth:n.borderWidth};c&&(l.options=t),o.updateElement(e[i],i,l,a)}}}x.id="candlestick",x.defaults=b({dataElementType:p.id},f.defaults.financial);const y=l.default.Chart,{merge:P,valueOrDefault:v}=l.default.helpers,w=y.defaults;class k extends d{draw(e){const t=this,{x:l,open:a,high:o,low:n,close:r}=t,i=v(t.armLengthRatio,w.elements.ohlc.armLengthRatio);let s=v(t.armLength,w.elements.ohlc.armLength);null===s&&(s=t.width*i*.5),e.strokeStyle=r<a?v(t.color?t.color.up:void 0,w.elements.ohlc.color.up):r>a?v(t.color?t.color.down:void 0,w.elements.ohlc.color.down):v(t.color?t.color.unchanged:void 0,w.elements.ohlc.color.unchanged),e.lineWidth=v(t.lineWidth,w.elements.ohlc.lineWidth),e.beginPath(),e.moveTo(l,o),e.lineTo(l,n),e.moveTo(l-s,a),e.lineTo(l,a),e.moveTo(l+s,r),e.lineTo(l,r),e.stroke()}}k.id="ohlc",k.defaults=P({},[w.elements.financial,{lineWidth:2,armLength:null,armLengthRatio:.8}]);const M=l.default.Chart,{merge:_}=l.default.helpers;class S extends s{updateElements(e,t,l,a){const o=this,n=o.getDataset(),r=o._ruler||o._getRuler(),i=o.resolveDataElementOptions(t,a),s=o.getSharedOptions(i),c=o.includeOptions(a,s);for(let t=0;t<l;t++){const l=s||o.resolveDataElementOptions(t,a),i={...o.calculateElementProperties(t,r,"reset"===a,l),datasetLabel:n.label||"",lineWidth:n.lineWidth,armLength:n.armLength,armLengthRatio:n.armLengthRatio,color:n.color};c&&(i.options=l),o.updateElement(e[t],t,i,a)}}}S.id="ohlc",S.defaults=_({dataElementType:k.id,datasets:{barPercentage:1,categoryPercentage:1}},M.defaults.financial),e.Chart.register(x,S,p,k)}));

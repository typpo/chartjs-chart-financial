/*!
 * @license
 * chartjs-chart-financial
 * http://chartjs.org/
 * Version: 0.1.0
 *
 * Copyright 2022 Chart.js Contributors
 * Released under the MIT license
 * https://github.com/chartjs/chartjs-chart-financial/blob/master/LICENSE.md
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("chart.js-v3"),require("luxon")):"function"==typeof define&&define.amd?define(["chart.js-v3","luxon"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ChartJs,e.luxon)}(this,(function(e,t){"use strict";function l(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=l(e),a=l(t);const{BarController:n,defaults:r}=o.default,{clipArea:i,isNullOrUndef:s,unclipArea:c}=o.default.helpers;class d extends n{getLabelAndValue(e){const t=this,l=t.getParsed(e),o=t._cachedMeta.iScale.axis,{o:a,h:n,l:r,c:i}=l,s=`O: ${a}  H: ${n}  L: ${r}  C: ${i}`;return{label:`${t._cachedMeta.iScale.getLabelForValue(l[o])}`,value:s}}getAllParsedValues(){const e=this._cachedMeta,t=e.iScale.axis,l=e._parsed,o=[];for(let e=0;e<l.length;++e)o.push(l[e][t]);return o}getMinMax(e){const t=this._cachedMeta,l=t._parsed,o=t.iScale.axis;if(l.length<2)return{min:0,max:1};if(e===t.iScale)return{min:l[0][o],max:l[l.length-1][o]};let a=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;for(let e=0;e<l.length;e++){const t=l[e];a=Math.min(a,t.l),n=Math.max(n,t.h)}return{min:a,max:n}}_getRuler(){const e=this,t=e.options,l=e._cachedMeta,o=l.iScale,a=o.axis,n=[];for(let t=0;t<l.data.length;++t)n.push(o.getPixelForValue(e.getParsed(t)[a]));const r=t.barThickness,i=function(e,t){let l,o,a,n,r=e._length;for(a=1,n=t.length;a<n;++a)r=Math.min(r,Math.abs(t[a]-t[a-1]));for(a=0,n=e.ticks.length;a<n;++a)o=e.getPixelForTick(a),r=a>0?Math.min(r,Math.abs(o-l)):r,l=o;return r}(o,n);return{min:i,pixels:n,start:o._startPixel,end:o._endPixel,stackCount:e._getStackCount(),scale:o,ratio:r?1:t.categoryPercentage*t.barPercentage}}calculateElementProperties(e,t,l,o){const a=this,n=a._cachedMeta.vScale,r=n.getBasePixel(),i=a._calculateBarIndexPixels(e,t,o),s=a.chart.data.datasets[a.index].data[e],c=n.getPixelForValue(s.o),d=n.getPixelForValue(s.h),h=n.getPixelForValue(s.l),u=n.getPixelForValue(s.c);return{base:l?r:h,x:i.center,y:(h+d)/2,width:i.size,open:c,high:d,low:h,close:u}}draw(){const e=this,t=e.chart,l=e._cachedMeta.data;i(t.ctx,t.chartArea);for(let t=0;t<l.length;++t)l[t].draw(e._ctx);c(t.ctx)}}d.overrides={label:"",parsing:!1,hover:{mode:"label"},datasets:{categoryPercentage:.8,barPercentage:.9,animation:{numbers:{type:"number",properties:["x","y","base","width","open","high","low","close"]}}},scales:{x:{type:"timeseries",offset:!0,ticks:{major:{enabled:!0},fontStyle:e=>e.tick.major?"bold":void 0,source:"data",maxRotation:0,autoSkip:!0,autoSkipPadding:75,sampleSize:100},afterBuildTicks:e=>{const t=a.default.DateTime;if(!t)return;const l=e._majorUnit,o=e.ticks,n=o[0];if(!n)return;let r=t.fromMillis(n.value);"minute"===l&&0===r.second||"hour"===l&&0===r.minute||"day"===l&&9===r.hour||"month"===l&&r.day<=3&&1===r.weekday||"year"===l&&1===r.month?n.major=!0:n.major=!1;let i=r.get(l);for(let e=1;e<o.length;e++){const a=o[e];r=t.fromMillis(a.value);const n=r.get(l);a.major=n!==i,i=n}e.ticks=o}},y:{type:"linear"}},plugins:{tooltip:{intersect:!1,mode:"index",callbacks:{label(e){const t=e.parsed;if(!s(t.y))return r.plugins.tooltip.callbacks.label(e);const{o:l,h:o,l:a,c:n}=t;return`O: ${l}  H: ${o}  L: ${a}  C: ${n}`}}}}};function h(e,t,l,o){const a=null===t,n=null===l,r=!(!e||a&&n)&&function(e,t){const{x:l,y:o,base:a,width:n,height:r}=e.getProps(["x","low","high","width","height"],t);let i,s,c,d,h;return e.horizontal?(h=r/2,i=Math.min(l,a),s=Math.max(l,a),c=o-h,d=o+h):(h=n/2,i=l-h,s=l+h,c=Math.min(o,a),d=Math.max(o,a)),{left:i,top:c,right:s,bottom:d}}(e,o);return r&&(a||t>=r.left&&t<=r.right)&&(n||l>=r.top&&l<=r.bottom)}e.Chart.defaults.elements.financial={color:{up:"rgba(80, 160, 115, 1)",down:"rgba(215, 85, 65, 1)",unchanged:"rgba(90, 90, 90, 1)"}};class u extends e.Element{height(){return this.base-this.y}inRange(e,t,l){return h(this,e,t,l)}inXRange(e,t){return h(this,e,null,t)}inYRange(e,t){return h(this,null,e,t)}getRange(e){return"x"===e?this.width/2:this.height/2}getCenterPoint(e){const{x:t,low:l,high:o}=this.getProps(["x","low","high"],e);return{x:t,y:(o+l)/2}}tooltipPosition(e){const{x:t,open:l,close:o}=this.getProps(["x","open","close"],e);return{x:t,y:(l+o)/2}}}const g=o.default.Chart,{merge:m,valueOrDefault:f}=o.default.helpers,p=g.defaults;class x extends u{draw(e){const t=this,{x:l,open:o,high:a,low:n,close:r}=t;let i,s=t.borderColor;"string"==typeof s&&(s={up:s,down:s,unchanged:s}),r<o?(i=f(s?s.up:void 0,p.elements.candlestick.borderColor),e.fillStyle=f(t.color?t.color.up:void 0,p.elements.candlestick.color.up)):r>o?(i=f(s?s.down:void 0,p.elements.candlestick.borderColor),e.fillStyle=f(t.color?t.color.down:void 0,p.elements.candlestick.color.down)):(i=f(s?s.unchanged:void 0,p.elements.candlestick.borderColor),e.fillStyle=f(t.color?t.color.unchanged:void 0,p.elements.candlestick.color.unchanged)),e.lineWidth=f(t.borderWidth,p.elements.candlestick.borderWidth),e.strokeStyle=f(i,p.elements.candlestick.borderColor),e.beginPath(),e.moveTo(l,a),e.lineTo(l,Math.min(o,r)),e.moveTo(l,n),e.lineTo(l,Math.max(o,r)),e.stroke(),e.fillRect(l-t.width/2,r,t.width,o-r),e.strokeRect(l-t.width/2,r,t.width,o-r),e.closePath()}}x.id="candlestick",x.defaults=m({},[p.elements.financial,{borderColor:p.elements.financial.color.unchanged,borderWidth:1}]);const b=o.default.Chart,{merge:y}=o.default.helpers;class P extends d{updateElements(e,t,l,o){const a=this,n=a.getDataset(),r=a._ruler||a._getRuler(),i=a.resolveDataElementOptions(t,o),s=a.getSharedOptions(i),c=a.includeOptions(o,s);a.updateSharedOptions(s,o,i);for(let i=t;i<l;i++){const t=s||a.resolveDataElementOptions(i,o),l={...a.calculateElementProperties(i,r,"reset"===o,t),datasetLabel:n.label||"",color:n.color,borderColor:n.borderColor,borderWidth:n.borderWidth};c&&(l.options=t),a.updateElement(e[i],i,l,o)}}}P.id="candlestick",P.defaults=y({dataElementType:x.id},b.defaults.financial);const k=o.default.Chart,{merge:v,valueOrDefault:w}=o.default.helpers,M=k.defaults;class _ extends u{draw(e){const t=this,{x:l,open:o,high:a,low:n,close:r}=t,i=w(t.armLengthRatio,M.elements.ohlc.armLengthRatio);let s=w(t.armLength,M.elements.ohlc.armLength);null===s&&(s=t.width*i*.5),e.strokeStyle=r<o?w(t.color?t.color.up:void 0,M.elements.ohlc.color.up):r>o?w(t.color?t.color.down:void 0,M.elements.ohlc.color.down):w(t.color?t.color.unchanged:void 0,M.elements.ohlc.color.unchanged),e.lineWidth=w(t.lineWidth,M.elements.ohlc.lineWidth),e.beginPath(),e.moveTo(l,a),e.lineTo(l,n),e.moveTo(l-s,o),e.lineTo(l,o),e.moveTo(l+s,r),e.lineTo(l,r),e.stroke()}}_.id="ohlc",_.defaults=v({},[M.elements.financial,{lineWidth:2,armLength:null,armLengthRatio:.8}]);const T=o.default.Chart,{merge:C}=o.default.helpers;class S extends d{updateElements(e,t,l,o){const a=this,n=a.getDataset(),r=a._ruler||a._getRuler(),i=a.resolveDataElementOptions(t,o),s=a.getSharedOptions(i),c=a.includeOptions(o,s);for(let t=0;t<l;t++){const l=s||a.resolveDataElementOptions(t,o),i={...a.calculateElementProperties(t,r,"reset"===o,l),datasetLabel:n.label||"",lineWidth:n.lineWidth,armLength:n.armLength,armLengthRatio:n.armLengthRatio,color:n.color};c&&(i.options=l),a.updateElement(e[t],t,i,o)}}}S.id="ohlc",S.defaults=C({dataElementType:_.id,datasets:{barPercentage:1,categoryPercentage:1}},T.defaults.financial),e.Chart.register(P,S,x,_)}));
